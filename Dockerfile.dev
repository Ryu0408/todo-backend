# todo-backend/Dockerfile.dev
FROM gradle:8.5-jdk17

WORKDIR /app
ENV GRADLE_USER_HOME=/home/gradle/.gradle

# gradle 랩퍼/설정 먼저 복사 → 의존성 캐시
COPY gradlew ./
COPY gradle ./gradle
COPY settings.gradle* build.gradle* ./
RUN chmod +x ./gradlew
# 선택: 리소스만 먼저 복사해서 일부 캐시 따오기
COPY src/main/resources/ ./src/main/resources/

# 의존성만 먼저 받아 캐시 (소스 전체 복사 전)
RUN ./gradlew --no-daemon dependencies || true

# 개발모드: 실제 소스는 compose의 volume이 덮어씀
CMD ["./gradlew", "bootRun", "--no-daemon", "-Dspring-boot.run.profiles=docker"]
